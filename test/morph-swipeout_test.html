<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>morph-swipeout test</title>

    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <script src="../../iron-test-helpers/mock-interactions.js"></script>

    <link rel="import" href="../morph-swipeout.html">
    <link rel="import" href="../../polymer/lib/mixins/gesture-event-listeners.html">
    <link rel="import" href="../../morph-shared-colors/morph-shared-colors.html">
    <link rel="import" href="../../morph-button/morph-button.html">
  </head>
  <body>

    <test-fixture id="BasicIosTestFixture">
      <template>
        <morph-swipeout platform="ios">
          <span slot="left-buttons">
            <morph-button platform="ios" color="green" filled big flat>Action</morph-button>
          </span>
          Swipeout content
          <span slot="right-buttons">
            <morph-button platform="ios" color="red" filled big flat>Delete</morph-button>
          </span>
        </morph-swipeout>
      </template>
    </test-fixture>

    <test-fixture id="BasicAndroidTestFixture">
      <template>
        <morph-swipeout platform="android">
          <span slot="left-buttons">
            <morph-button platform="android" color="green" filled big flat>Action</morph-button>
          </span>
          Swipeout content
          <span slot="right-buttons">
            <morph-button platform="android" color="red" filled big flat>Delete</morph-button>
          </span>
        </morph-swipeout>
      </template>
    </test-fixture>

    <test-fixture id="IosTestFixtureOverswiper">
      <template>
        <morph-swipeout platform="ios" overswiper>
          <span slot="left-buttons">
            <morph-button platform="ios" color="green" filled big flat>Action</morph-button>
          </span>
          Swipeout content
          <span slot="right-buttons">
            <morph-button platform="ios" color="red" filled big flat>Delete</morph-button>
          </span>
        </morph-swipeout>
      </template>
    </test-fixture>

    <script>
      describe('morph-swipeout', () => {

        describe('_getMorphButtonElement()', () => {
          let iosElement;

          beforeEach( function() {
            iosElement = fixture('BasicIosTestFixture');
          });

          it('Should return the correct button from left', () => {
            const buttonPosition = 'left';
            const leftMorphButton = iosElement._getMorphButtonElement(buttonPosition);

            expect(leftMorphButton.getAttribute('color')).to.equal('green');
          });

          it('Should return the correct button from right', () => {
            const buttonPosition = 'right';
            const leftMorphButton = iosElement._getMorphButtonElement(buttonPosition);

            expect(leftMorphButton.getAttribute('color')).to.equal('red');
          });

          it('Should return the correct color attribute of left morph-button', () => {
            const buttonPosition = 'left';
            const morphButtonReturnedColorAttribute = iosElement._getMorphButtonElement(buttonPosition).color;
            const expectedColorAttributeOfMorphButton = 'green';
            
            expect(morphButtonReturnedColorAttribute).to.be.equal(expectedColorAttributeOfMorphButton);
          });

          it('Should return the correct color attribute of right morph-button', () => {
            const buttonPosition = 'right';
            const morphButtonReturnedColorAttribute = iosElement._getMorphButtonElement(buttonPosition).color;
            const expectedColorAttributeOfMorphButton = 'red';

            expect(morphButtonReturnedColorAttribute).to.be.equal(expectedColorAttributeOfMorphButton);
          });



        });

        describe('_getElementBackgroundColor(element) for IOS platform', () => {
          let element2;
          beforeEach(function () {
            element2 = fixture('BasicIosTestFixture');
          });

          it('Should return the correct background-color for left morph-button', () => {
            const leftMorphButton = element2._getMorphButtonElement('left');
            const result = element2._getElementBackgroundColor(leftMorphButton);
            const styles = window.getComputedStyle(leftMorphButton);
            const expectedBackgroundColor = 'rgb(76, 217, 100)';

            expect(result).to.equal(expectedBackgroundColor);
          });

          it('Should return the correct background-color for right morph-button', () => {
            const rightMorphButton = element2._getMorphButtonElement('right');
            const result = element2._getElementBackgroundColor(rightMorphButton);
            const expectedBackgroundColor = 'rgb(255, 59, 48)';

            expect(result).to.equal(expectedBackgroundColor);
          });

        });

        // BasicAndroidTestFixture
        describe('_getElementBackgroundColor(buttonPosition) for Android platform', () => {
          let element, result;
          let rightMorphButton;

          beforeEach(function (done) {
            element = fixture('BasicAndroidTestFixture');
            rightMorphButton = element._getMorphButtonElement('left');
            // get the background color of morph-button after the 300ms transition timing of translate3d
            setTimeout(function() {
              result = element._getElementBackgroundColor(rightMorphButton);
              done();
            }, 400);
          });

          it('Should return the correct background-color for left morph-button', () => {
            const expectedBackgroundColor = 'rgb(76, 175, 80)';

            expect(result).to.equal(expectedBackgroundColor); 
          });

        });

        describe('handleTrack(event) for iOS', () => {
          let element, functionStub;
          let mockEvent;

          beforeEach( () => {
            element = fixture('BasicIosTestFixture');

            stub('morph-swipeout', {
              handleTrack: function () {
                console.log('handleTrack called!');
              }
            });
          });

          it('Should call handleTrack when track event is fired', (done) => {

            flush(function() {
              expect(element.handleTrack.callCount).to.be.equal(0);

              Polymer.Gestures.addListener(element, 'track', e => {
                console.log('Hello track!');
                expect(element.handleTrack.callCount).to.be.equal(1);
                done();
              });
              var event = new CustomEvent('track', {
                detail: {dx: 200}
              });
              
              element.dispatchEvent(event);
            });
            
          });
          
          
        });
        
        describe('overswiper for IOS', () => {
          it('Should call _completeOverswipe when ', () => {});
          it('Should call _handleOverswipe when', () => {});
          
        });
        
        // let topLeft = MockInteractions.topLeftOfNode(element);
        // let middleOfNode = MockInteractions.middleOfNode(element);

        // MockInteractions.touchstart(element);
        // MockInteractions.track(element, -20, 22, 10);
        // MockInteractions.touchend(element);
        // MockInteractions.tap(element);
      });



    </script>

  </body>
</html>
